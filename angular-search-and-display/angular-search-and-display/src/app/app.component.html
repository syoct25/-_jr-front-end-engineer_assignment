<div class="h-screen flex flex-col">
  <!-- 1. 表單事件處理 -->
  <!-- 原本沒有預防表單預設提交行為，加入 preventDefault 來避免頁面重新載入 -->
  <form (submit)="$event.preventDefault()">
    <mat-form-field class="w-full">
      <input
        matInput
        placeholder="Enter a book title"
        [value]="$search.searchText"
        (input)="onSearchInputChange($event)"
      />
      <!-- 2. 搜尋按鈕空值檢查 -->
      <!-- 原本按鈕沒有檢查空值，現在加入 disabled 屬性綁定 -->
      <!-- 使用 trim() 確保純空白字串也會被視為空值 -->
      <button 
        mat-icon-button 
        matSuffix 
        [disabled]="!$search.searchText.trim()"
        (click)="$search.submit()"
      >
        <mat-icon>search</mat-icon>
      </button>
    </mat-form-field>
  </form>
<!-- 只在有搜尋結果時顯示列表 -->
@if (searchResults$ | async; as results) {
  <mat-list role="list" class="flex-grow min-h-0 overflow-y-auto">
    @for (result of results.docs; track result.title) {
      <mat-list-item role="listitem">
        <img
          matListItemAvatar
          [src]="
            'https://covers.openlibrary.org/b/olid/' +
            result.cover_edition_key +
            '-M.jpg'
          "
        />
        <div matListItemTitle>{{ result.title }}</div>
        <div matListItemLine>{{ result.author_name?.join(", ") }}</div>
      </mat-list-item>
    }
  </mat-list>

  <!-- 分頁控制 -->
  @if (results.num_found) {
    <mat-paginator
      class="border-0 border-t border-black border-solid"
      [length]="results.num_found"
      [pageIndex]="$search.page - 1"
      [pageSize]="$search.pageSize"
      [pageSizeOptions]="[5, 10, 25, 50]"
      (page)="onPageChange($event)"
      aria-label="Select page"
    />
  }
}
</div>
